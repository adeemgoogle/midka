 public string ReadOrders()
 {
     if (isReadingTable["ORDERS"])
     {
         return "Already reading ORDERS table";
     }
     checkConnection();

     isReadingTable["ORDERS"] = true;
     Thread thread = new Thread(WriteOrders);
     thread.Start();

     return "OK";
 }

 private void WriteOrders()
 {
     Console.WriteLine("starting read ORDERS table...");
     int tableDescriptor;
     var table = OpenTableNonString("ORDERS", null, out tableDescriptor);
     var orders = OrderTable.ParseOrdersFromUniversalTable(table);
     if (orders.Rows != null && orders.Rows.Count != 0)
     {
         var partitions = orders.Rows.partition(500);
         foreach (var partition in partitions)
         {
             OrderTable orderTable = new OrderTable(table.Name, table.Ref);
             orderTable.Rows = (List<OrderRow>)partition;
             var jsonStr = JsonConvert.SerializeObject(orderTable);
             Kafka.Write("BROKERAGE-KASE-ASTS-ALLOCATIONS", "ORDERS", jsonStr);
         }

         Console.WriteLine("ORDERS table was written to Kafka succesfully");
         isReadingTable["ORDERS"] = false;
     }
     else
     {
         Console.WriteLine("ORDERS table is empty");
         isReadingTable["ORDERS"] = false;
     }
 }

private void checkConnection()
{
    AstsServer.ConnectionStatus();
    if (!AstsServer.IsConnected)
    {
        Connect();
    }
}
