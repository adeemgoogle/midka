WITH RECURSIVE LocationHierarchy AS (
    SELECT
        s_ats.id AS location_id,
        d_ats_types.value_ru AS location_name_ru,
        d_ats_types.value_kz AS location_name_kz,
        s_ats.parent_id
    FROM
        s_ats
    JOIN
        d_ats_types ON s_ats.d_ats_type_id = d_ats_types.id
    WHERE
        s_ats.id = '1' -- Начнем с республики
    UNION ALL
    SELECT
        s_ats.id,
        d_ats_types.value_ru,
        d_ats_types.value_kz,
        s_ats.parent_id
    FROM
        LocationHierarchy
    JOIN
        s_ats ON LocationHierarchy.location_id = s_ats.parent_id
    JOIN
        d_ats_types ON s_ats.d_ats_type_id = d_ats_types.id
)

SELECT
    LH.location_name_ru AS Republic_ru,
    LH.location_name_kz AS Republic_kz,
    LO1.location_name_ru AS Region_ru,
    LO1.location_name_kz AS Region_kz,
    LO2.location_name_ru AS District_ru,
    LO2.location_name_kz AS District_kz,
    LO3.location_name_ru AS City_ru,
    LO3.location_name_kz AS City_kz
FROM
    LocationHierarchy LH
LEFT JOIN
    LocationHierarchy LO1 ON LH.location_id = LO1.parent_id
LEFT JOIN
    LocationHierarchy LO2 ON LO1.location_id = LO2.parent_id
LEFT JOIN
    LocationHierarchy LO3 ON LO2.location_id = LO3.parent_id
WHERE
    LH.parent_id IS NULL; -- Это фильтрует только республику
