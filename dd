{"@t":"2024-06-10T12:46:03.9537477Z","@m":"Process error: ","@i":"1323b270","@l":"Error","@x":"System.ArgumentException: key=value argument incorrect in ConnectionString\r\nParameter name: data source\r\n   at Npgsql.NpgsqlConnectionStringBuilder.GetKey(String key)\r\n   at Npgsql.NpgsqlConnectionStringBuilder.set_Item(String keyword, Object value)\r\n   at System.Data.Common.DbConnectionStringBuilder.set_ConnectionString(String value)\r\n   at Npgsql.NpgsqlConnection..ctor(String ConnectionString)\r\n
using System;
using System.Data;
using Microsoft.Extensions.Configuration;
using Npgsql;

public class DatabaseConnector
{
    private readonly IConfiguration _configuration;

    public DatabaseConnector(IConfiguration configuration)
    {
        _configuration = configuration;
    }

    public IDbConnection ConnectToDB()
    {
        return Connect("db");
    }

    private IDbConnection Connect(string connectionName)
    {
        var connectionString = _configuration.GetConnectionString(connectionName);
        if (string.IsNullOrWhiteSpace(connectionString))
        {
            throw new ArgumentException($"Connection string '{connectionName}' is missing or empty.");
        }

        var connection = new NpgsqlConnection(connectionString);

        try
        {
            connection.Open();
            Console.WriteLine($"Connection to {connectionName} established successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An error occurred while connecting to {connectionName}: {ex.Message}");
            throw;
        }

        return connection;
    }
}
