using Quartz;
using System.Threading.Tasks;

public class MyJob : IJob
{
    private readonly IConfiguration _config;

    public MyJob(IConfiguration config)
    {
        _config = config;
    }

    public Task Execute(IJobExecutionContext context)
    {
        var dbConnector = new PostgresService(_config);
        var connection = dbConnector.ConnectToDB();

        Log.Information("Loading trade points data");

        KATORepository katoRep = new KATORepository(_config);
        var katodict = katoRep.GetKATORef();

        TradePointsRepository tradePointsRep = new TradePointsRepository(_config, katodict);
        var aTMs = tradePointsRep.GetAtms();
        var branches = tradePointsRep.GetBranches();
        dbConnector.AddBranches(branches);
        dbConnector.AddBranchs(branches);
        dbConnector.AddKATO(katodict);
        dbConnector.AddATMs(aTMs);
        dbConnector.AddAtms(aTMs);

        Log.Information("Process finished");

        return Task.CompletedTask;
    }
}
